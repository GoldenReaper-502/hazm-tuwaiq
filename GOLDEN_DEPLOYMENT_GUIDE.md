# ğŸ† HAZM TUWAIQ - Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ

## ğŸ“š Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

1. [ØªØ´ØºÙŠÙ„ Frontend ÙÙŠ Codespaces](#ØªØ´ØºÙŠÙ„-frontend-ÙÙŠ-codespaces)
2. [Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© Ø¹Ù„Ù‰ Render](#Ø¥Ø¹Ø¯Ø§Ø¯-Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª-Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©-Ø¹Ù„Ù‰-render)
3. [Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù…Ù† Endpoints](#Ø§Ù„ØªØ­Ù‚Ù‚-Ø§Ù„Ø³Ø±ÙŠØ¹-Ù…Ù†-endpoints)
4. [Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ](#Ø§Ø®ØªØ¨Ø§Ø±-Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©-Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡-Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ-Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ)

---

## ØªØ´ØºÙŠÙ„ Frontend ÙÙŠ Codespaces

### Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ´ØºÙŠÙ„ Ø®Ø§Ø¯Ù… HTTP Ù…Ø­Ù„ÙŠ

```bash
cd /workspaces/hazm-tuwaiq/frontend
python3 -m http.server 8080
```

### Ø§Ù„Ø®Ø·ÙˆØ© 2: ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­

ÙÙŠ CodespacesØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ports" ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠØŒ Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© "Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø£Ø±Ø¶ÙŠØ©" Ø¨Ø¬ÙˆØ§Ø± Ø§Ù„Ù…Ù†ÙØ° 8080.

Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù…:
```bash
$BROWSER http://localhost:8080
```

### Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª

- **Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ**: [http://localhost:8080/index_golden.html](http://localhost:8080/index_golden.html)
- **Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ**: [http://localhost:8080/index.html](http://localhost:8080/index.html)

---

## Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© Ø¹Ù„Ù‰ Render

### Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ

1. Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Render: [https://dashboard.render.com](https://dashboard.render.com)

2. Ø§Ø®ØªØ± Ø®Ø¯Ù…Ø© `hazm-tuwaiq-3`

3. Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ **Environment** â†’ **Environment Variables**

4. Ø£Ø¶Ù Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:

```
OPENAI_API_KEY=sk-...your-key-here
OPENAI_MODEL=gpt-4o-mini
LLM_PROVIDER=openai
```

**Ù…Ù„Ø§Ø­Ø¸Ø©**: Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ OpenAI:
- Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ [https://platform.openai.com/api-keys](https://platform.openai.com/api-keys)
- Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯
- Ø§Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­ (Ø³ÙŠØ¸Ù‡Ø± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·!)

5. Ø§Ø¶ØºØ· **Save Changes**

6. Ø£Ø¹Ø¯ Ù†Ø´Ø± Ø§Ù„Ø®Ø¯Ù…Ø©:

```bash
# ÙÙŠ Codespaces
git add .
git commit -m "Enable real AI chat"
git push origin main
```

Render Ø³ØªØ¹ÙŠØ¯ Ø§Ù„Ù†Ø´Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.

---

## Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù…Ù† Endpoints

### Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø³ÙƒØ±ÙŠØ¨Øª Validate

```bash
cd /workspaces/hazm-tuwaiq/backend
python3 validate.py
```

Ø³ÙŠØ®ØªØ¨Ø± Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª:
- âœ… `/health` - ÙØ­Øµ Ø§Ù„ØµØ­Ø©
- âœ… `/system/status` - Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
- âœ… `/chat` - Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
- âœ… `/detect` - Ø§Ù„ÙƒØ´Ù

### Ø§Ø³ØªØ®Ø¯Ø§Ù… curl ÙŠØ¯ÙˆÙŠÙ‹Ø§

#### ÙØ­Øµ Ø§Ù„ØµØ­Ø©
```bash
curl https://hazm-tuwaiq-3.onrender.com/health
```

Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:
```json
{"status": "ok", "timestamp": "..."}
```

#### Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
```bash
curl https://hazm-tuwaiq-3.onrender.com/system/status
```

Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:
```json
{
  "llm_available": true,
  "cctv_available": true,
  "last_error": null
}
```

#### Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
```bash
curl -X POST https://hazm-tuwaiq-3.onrender.com/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Ù…Ø§ Ù‡ÙŠ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŸ",
    "session_id": "test"
  }'
```

Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (Ù…Ø¹ AI Ø­Ù‚ÙŠÙ‚ÙŠ):
```json
{
  "message": "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ØªØ´Ù…Ù„...",
  "sources": ["ISO 45001", "OSHA"],
  "confidence": 0.95
}
```

Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (Ø¨Ø¯ÙˆÙ† AI - ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ):
```json
{
  "message": "âš ï¸ LLM service unavailable...",
  "fallback_mode": true
}
```

---

## Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ

### ÙƒÙŠÙ ØªØ¹Ø±Ù Ø£Ù† AI ÙŠØ¹Ù…Ù„ØŸ

#### Ù…Ø¤Ø´Ø±Ø§Øª AI Ø­Ù‚ÙŠÙ‚ÙŠ âœ…
- Ø±Ø³Ø§Ø¦Ù„ Ø·ÙˆÙŠÙ„Ø© ÙˆÙ…ÙØµÙ„Ø©
- Ø¥Ø¬Ø§Ø¨Ø§Øª Ø³ÙŠØ§Ù‚ÙŠØ© ÙˆÙ…Ù†Ø·Ù‚ÙŠØ©
- Ù…Ø±Ø§Ø¬Ø¹ Ù…Ø­Ø¯Ø¯Ø© (ISO 45001, OSHA)
- Ø¯Ø±Ø¬Ø© Ø«Ù‚Ø© (confidence) Ø¹Ø§Ù„ÙŠØ©
- Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© "fallback_mode"

#### Ù…Ø¤Ø´Ø±Ø§Øª ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ âš ï¸
- Ø±Ø³Ø§Ù„Ø© ØªØ¨Ø¯Ø£ Ø¨Ù€ "âš ï¸ LLM service unavailable"
- `"fallback_mode": true` ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
- Ø±Ø³Ø§Ø¦Ù„ Ù‚ØµÙŠØ±Ø© ÙˆÙ†Ù…Ø·ÙŠØ©
- Ù†ÙØ³ Ø§Ù„Ø±Ø¯ Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ø®ØªÙ„ÙØ©

### Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

1. Ø§ÙØªØ­ Dashboard Ø§Ù„Ø°Ù‡Ø¨ÙŠ
2. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ **Safety Copilot Chat**
3. Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ù…Ø¹Ù‚Ø¯:
   ```
   Ù…Ø§ Ù‡ÙŠ Ø£Ù‡Ù… 5 Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø§Ø¡ Ø¨Ù‡ Ø±Ø§ÙØ¹Ø§ØªØŸ
   ```

4. Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:
   - **Ù…ÙØµÙ„Ø© ÙˆÙ…Ø±Ù‚Ù…Ø©** â†’ âœ… AI Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠØ¹Ù…Ù„
   - **"âš ï¸ LLM service unavailable"** â†’ âš ï¸ ØªØ­Ù‚Ù‚ Ù…Ù† OPENAI_API_KEY

---

## Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„

### Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: "OPENAI_API_KEY not set"

**Ø§Ù„Ø­Ù„:**
```bash
# ÙÙŠ Render Dashboard
Environment Variables â†’ Add
Name: OPENAI_API_KEY
Value: sk-...your-key
```

### Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: "Chat always returns fallback"

**Ø§Ù„Ø­Ù„:**
1. ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† `OPENAI_API_KEY` ØµØ§Ù„Ø­
2. ØªØ­Ù‚Ù‚ Ù…Ù† Ø±ØµÙŠØ¯ OpenAI: [https://platform.openai.com/usage](https://platform.openai.com/usage)
3. ØªØ­Ù‚Ù‚ Ù…Ù† Logs ÙÙŠ Render:
```bash
# ÙÙŠ Render Dashboard
Logs â†’ Latest Logs
```

### Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: "Module cv2 not found"

**Ø§Ù„Ø­Ù„:**
```bash
# ÙÙŠ backend/requirements.txt
opencv-python-headless==4.8.1.78
```

Ø«Ù…:
```bash
git add backend/requirements.txt
git commit -m "Add opencv"
git push
```

---

## Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©

### Frontend Files (Golden Edition)
```
frontend/
â”œâ”€â”€ index_golden.html     # ØµÙØ­Ø© Ø±Ø¦ÙŠØ³ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ 7 ÙˆØ­Ø¯Ø§Øª
â”œâ”€â”€ styles_golden.css     # Ù†Ø¸Ø§Ù… ØªØµÙ…ÙŠÙ… ÙƒØ§Ù…Ù„ Ù…Ø¹ Dark Mode
â”œâ”€â”€ app_golden.js         # Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„
â””â”€â”€ assets/               # Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
```

### Backend Structure
```
backend/
â”œâ”€â”€ app.py               # ØªØ·Ø¨ÙŠÙ‚ FastAPI Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
â”œâ”€â”€ llm.py               # ØªÙƒØ§Ù…Ù„ LLM (OpenAI/Anthropic)
â”œâ”€â”€ cctv.py              # Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª
â”œâ”€â”€ behavior.py          # ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ù„ÙˆÙƒ
â”œâ”€â”€ tracking.py          # ØªØªØ¨Ø¹ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª
â”œâ”€â”€ report_generator.py  # ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
â””â”€â”€ validate.py          # Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªØ­Ù‚Ù‚
```

---

## Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©

### 1. System Status âœ…
- Ø­Ø§Ù„Ø© LLM
- Ø­Ø§Ù„Ø© CCTV
- Ø¢Ø®Ø± Ø®Ø·Ø£
- Endpoint: `/system/status`

### 2. CCTV Management âœ…
- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª
- Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù ÙƒØ§Ù…ÙŠØ±Ø§
- Endpoints: `/cameras`, `/camera/add`, `/camera/delete`

### 3. Object Detection âœ…
- Ø±ÙØ¹ ØµÙˆØ±Ø©
- ÙƒØ´Ù Ø§Ù„Ù…Ø®Ø§Ø·Ø± (YOLO)
- Endpoint: `/detect`

### 4. Alerts & Incidents âœ…
- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
- ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
- Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§Ø¯Ø«Ø©/near-miss
- Endpoints: `/alerts`, `/alerts/ack`, `/incident`, `/near-miss`

### 5. Reports âœ…
- ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± PDF
- ØªØµØ¯ÙŠØ± Excel
- Endpoints: `/export/pdf`, `/export/excel`

### 6. Admin Panel âœ…
- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
- Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¯ÙˆØ§Ø±
- Endpoint: `/admin/roles`

### 7. Safety Copilot Chat âœ…
- Ø¯Ø±Ø¯Ø´Ø© Ø°ÙƒÙŠØ© Ù…Ø¹ AI
- Ø³ÙŠØ§Ù‚ ISO 45001/OSHA
- Endpoint: `/chat`

---

## Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©

### Dark/Light Theme
```javascript
// ÙÙŠ app_golden.js
document.getElementById('theme-toggle').addEventListener('click', () => {
  document.body.classList.toggle('dark-theme');
  localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
});
```

### Arabic/English Toggle
```javascript
// ÙÙŠ app_golden.js
document.getElementById('lang-toggle').addEventListener('click', () => {
  state.language = state.language === 'ar' ? 'en' : 'ar';
  updateLanguage();
});
```

### Safe API Calls
```javascript
// ÙÙŠ app_golden.js
async function apiFetch(endpoint, options = {}) {
  const rawResponse = await fetch(CONFIG.API_BASE_URL + endpoint, {
    headers: { 'Content-Type': 'application/json' },
    ...options
  });
  
  const text = await rawResponse.text();
  const contentType = rawResponse.headers.get('content-type');
  
  if (contentType && contentType.includes('application/json')) {
    return JSON.parse(text);
  } else {
    throw new Error(`Expected JSON but got: ${text.slice(0, 100)}`);
  }
}
```

---

## Ø§Ù„Ø®Ù„Ø§ØµØ©

âœ… **Frontend**: ØµÙØ­Ø© Ø°Ù‡Ø¨ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ 7 ÙˆØ­Ø¯Ø§Øª  
âœ… **Backend**: LLM Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ø¹ Safety Copilot  
âœ… **Testing**: Ø³ÙƒØ±ÙŠØ¨Øª validate.py Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø³Ø±ÙŠØ¹  
âœ… **Documentation**: Ø¯Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©

**Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±**: https://hazm-tuwaiq-3.onrender.com

---

## Ø§Ù„Ø¯Ø¹Ù…

Ù„Ù„Ù…Ø´Ø§ÙƒÙ„ Ø£Ùˆ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:
1. Ø±Ø§Ø¬Ø¹ [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
2. ØªØ­Ù‚Ù‚ Ù…Ù† Logs ÙÙŠ Render
3. Ø§Ø³ØªØ®Ø¯Ù… `validate.py` Ù„Ù„ØªØ´Ø®ÙŠØµ

