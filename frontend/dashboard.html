<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ - HAZM TUWAIQ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f7fafc;
            color: #2d3748;
        }

        /* Header */
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logo {
            font-size: 32px;
        }

        .header-info h1 {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .header-info p {
            font-size: 13px;
            opacity: 0.9;
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            text-align: left;
        }

        .user-name {
            font-weight: 600;
            font-size: 16px;
        }

        .user-role {
            font-size: 13px;
            opacity: 0.9;
        }

        .logout-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .logout-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Main Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 40px;
        }

        /* Welcome Card */
        .welcome-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-right: 5px solid #667eea;
        }

        .welcome-message {
            font-size: 24px;
            color: #2d3748;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .priority-message {
            font-size: 16px;
            color: #4a5568;
            line-height: 1.6;
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border-right: 3px solid #f6ad55;
        }

        .priority-label {
            font-weight: 600;
            color: #f6ad55;
            margin-left: 8px;
        }

        /* Quick Actions */
        .quick-actions {
            margin-top: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2d3748;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .action-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .action-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }

        .action-title {
            font-weight: 600;
            font-size: 15px;
            color: #2d3748;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 13px;
            color: #718096;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #2d3748;
        }

        .stat-trend {
            font-size: 12px;
            margin-top: 8px;
        }

        .trend-up {
            color: #48bb78;
        }

        .trend-down {
            color: #f56565;
        }

        /* Permissions Badge */
        .permissions-section {
            margin-top: 30px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .permission-badge {
            background: #edf2f7;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 13px;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .permission-badge::before {
            content: '‚úì';
            color: #48bb78;
            font-weight: bold;
        }

        /* Loading Spinner */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Role-specific colors */
        .role-owner { border-right-color: #9f7aea; }
        .role-manager { border-right-color: #4299e1; }
        .role-supervisor { border-right-color: #48bb78; }
        .role-worker { border-right-color: #ed8936; }
        .role-viewer { border-right-color: #718096; }

        @media (max-width: 768px) {
            .dashboard-header {
                padding: 15px 20px;
            }

            .dashboard-container {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .actions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-brand">
            <div class="header-logo">üåå</div>
            <div class="header-info">
                <h1>HAZM TUWAIQ</h1>
                <p>Before ‚â† After</p>
            </div>
        </div>
        <div class="header-user">
            <div class="user-info">
                <div class="user-name" id="userName">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>
                <div class="user-role" id="userRole"></div>
            </div>
            <button class="logout-button" onclick="logout()">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
        </div>
    </header>

    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <div id="loadingState" class="loading-container">
            <div class="spinner"></div>
        </div>

        <div id="dashboardContent" style="display: none;">
            <!-- Welcome Card -->
            <div class="welcome-card" id="welcomeCard">
                <div class="welcome-message" id="welcomeMessage"></div>
                <div class="priority-message">
                    <span class="priority-label">üéØ ÿ£ŸàŸÑŸàŸäÿ© ÿßŸÑŸäŸàŸÖ:</span>
                    <span id="priorityMessage"></span>
                </div>
            </div>

            <!-- Statistics -->
            <div class="stats-grid" id="statsGrid">
                <!-- Stats will be inserted dynamically -->
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h2 class="section-title">‚ö° ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ©</h2>
                <div class="actions-grid" id="actionsGrid">
                    <!-- Actions will be inserted dynamically -->
                </div>
            </div>

            <!-- Permissions -->
            <div class="permissions-section">
                <h2 class="section-title">üîê ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©</h2>
                <div class="permissions-grid" id="permissionsGrid">
                    <!-- Permissions will be inserted dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let currentUser = null;

        // Check authentication on load
        window.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('hazm_token');
            
            if (!token) {
                window.location.href = '/login.html';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Unauthorized');
                }

                const data = await response.json();
                currentUser = data;
                renderDashboard(data);
            } catch (error) {
                console.error('Dashboard error:', error);
                localStorage.removeItem('hazm_token');
                localStorage.removeItem('hazm_user');
                window.location.href = '/login.html';
            }
        });

        // Render dashboard based on user role
        function renderDashboard(data) {
            // Hide loading, show content
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('dashboardContent').style.display = 'block';

            // Set user info
            document.getElementById('userName').textContent = data.user.full_name;
            document.getElementById('userRole').textContent = getRoleDisplayName(data.role);

            // Set welcome message
            document.getElementById('welcomeMessage').textContent = data.welcome_message;
            document.getElementById('priorityMessage').textContent = data.priority;

            // Apply role-specific styling
            const welcomeCard = document.getElementById('welcomeCard');
            welcomeCard.classList.add(`role-${data.role}`);

            // Render statistics
            renderStats(data.role);

            // Render quick actions
            renderQuickActions(data.quick_actions);

            // Render permissions
            renderPermissions(data.permissions);
        }

        // Get role display name in Arabic
        function getRoleDisplayName(role) {
            const roleNames = {
                'owner': 'ÿµÿßÿ≠ÿ® ÿßŸÑŸÖŸÜÿµÿ©',
                'manager': 'ŸÖÿØŸäÿ± ÿßŸÑÿπŸÖŸÑŸäÿßÿ™',
                'supervisor': 'ŸÖÿ¥ÿ±ŸÅ ÿßŸÑŸÖŸàŸÇÿπ',
                'worker': 'ÿπÿßŸÖŸÑ',
                'viewer': 'ŸÖÿ±ÿßŸÇÿ®'
            };
            return roleNames[role] || role;
        }

        // Render statistics based on role
        function renderStats(role) {
            const statsGrid = document.getElementById('statsGrid');
            let stats = [];

            if (role === 'owner') {
                stats = [
                    { label: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖŸàÿßŸÇÿπ', value: '12', trend: '+2 Ÿáÿ∞ÿß ÿßŸÑÿ¥Ÿáÿ±', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸàŸÜ', value: '347', trend: '+23 ÿ¨ÿØŸäÿØ', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑŸäŸàŸÖ', value: '8', trend: '-12 ŸÖŸÜ ÿßŸÑÿ£ŸÖÿ≥', trendClass: 'trend-up' },
                    { label: 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ≥ŸÑÿßŸÖÿ©', value: '94%', trend: '+3% Ÿáÿ∞ÿß ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ', trendClass: 'trend-up' },
                ];
            } else if (role === 'manager') {
                stats = [
                    { label: 'ÿßŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑŸÖÿØÿßÿ±ÿ©', value: '3', trend: 'ÿ¨ŸÖŸäÿπŸáÿß ŸÜÿ¥ÿ∑ÿ©', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑÿπŸÖÿßŸÑ ÿßŸÑŸÜÿ¥ÿ∑ŸàŸÜ', value: '156', trend: '98% ÿ≠ÿßÿ∂ÿ±ŸàŸÜ', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑŸÜÿ¥ÿ∑ÿ©', value: '5', trend: 'ŸÖŸÜÿÆŸÅÿ∂ÿ©', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑÿßŸÖÿ™ÿ´ÿßŸÑ', value: '92%', trend: '+2%', trendClass: 'trend-up' },
                ];
            } else if (role === 'supervisor') {
                stats = [
                    { label: 'ÿßŸÑŸÖŸàŸÇÿπ', value: 'ŸÖŸàŸÇÿπ A', trend: 'ŸÜÿ¥ÿ∑ ÿßŸÑÿ¢ŸÜ', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑÿπŸÖÿßŸÑ ÿßŸÑÿ≠ÿßŸÑŸäŸàŸÜ', value: '48', trend: 'ÿ¨ŸÖŸäÿπŸáŸÖ ÿ¢ŸÖŸÜŸàŸÜ', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑŸäŸàŸÖ', value: '3', trend: 'ÿ™ÿ≠ÿ™ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑŸÖÿπÿØÿßÿ™', value: '12', trend: 'ŸÉŸÑŸáÿß ÿ≥ŸÑŸäŸÖÿ©', trendClass: 'trend-up' },
                ];
            } else if (role === 'worker') {
                stats = [
                    { label: 'ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≥ŸÑÿßŸÖÿ©', value: 'ÿ¢ŸÖŸÜ', trend: 'ŸÖŸÖÿ™ÿßÿ≤', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑÿ™ÿØÿ±Ÿäÿ®ÿßÿ™', value: '85%', trend: '3 ŸÖÿ™ÿ®ŸÇŸäÿ©', trendClass: 'trend-up' },
                    { label: 'ÿ≥ÿßÿπÿßÿ™ ÿßŸÑÿπŸÖŸÑ', value: '6.5', trend: 'ÿßŸÑŸäŸàŸÖ', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑŸÜŸÇÿßÿ∑', value: '342', trend: '+15 ÿßŸÑŸäŸàŸÖ', trendClass: 'trend-up' },
                ];
            } else {
                stats = [
                    { label: 'ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±', value: '24', trend: 'ŸÖÿ™ÿßÿ≠ÿ©', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', value: '100%', trend: 'ŸÖÿ≠ÿØÿ´ÿ©', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑŸÖÿ§ÿ¥ÿ±ÿßÿ™', value: '18', trend: 'ŸÜÿ¥ÿ∑ÿ©', trendClass: 'trend-up' },
                    { label: 'ÿßŸÑŸàÿµŸàŸÑ', value: 'ŸÇÿ±ÿßÿ°ÿ© ŸÅŸÇÿ∑', trend: '', trendClass: '' },
                ];
            }

            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-value">${stat.value}</div>
                    ${stat.trend ? `<div class="stat-trend ${stat.trendClass}">${stat.trend}</div>` : ''}
                </div>
            `).join('');
        }

        // Render quick actions
        function renderQuickActions(actions) {
            const actionsGrid = document.getElementById('actionsGrid');
            const actionIcons = ['üìä', 'üö®', 'üìù', '‚öôÔ∏è', 'üë•', 'üìπ', 'üîç', 'üí°'];

            actionsGrid.innerHTML = actions.map((action, index) => `
                <div class="action-card" onclick="performAction('${action}')">
                    <div class="action-icon">${actionIcons[index % actionIcons.length]}</div>
                    <div class="action-title">${action}</div>
                </div>
            `).join('');
        }

        // Render permissions
        function renderPermissions(permissions) {
            const permissionsGrid = document.getElementById('permissionsGrid');
            
            const permissionNames = {
                'view_dashboard': 'ÿπÿ±ÿ∂ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ',
                'view_analytics': 'ÿπÿ±ÿ∂ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™',
                'view_workers': 'ÿπÿ±ÿ∂ ÿßŸÑÿπŸÖÿßŸÑ',
                'manage_workers': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸÖÿßŸÑ',
                'view_sites': 'ÿπÿ±ÿ∂ ÿßŸÑŸÖŸàÿßŸÇÿπ',
                'manage_sites': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿßŸÇÿπ',
                'view_cameras': 'ÿπÿ±ÿ∂ ÿßŸÑŸÉÿßŸÖŸäÿ±ÿßÿ™',
                'manage_cameras': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÉÿßŸÖŸäÿ±ÿßÿ™',
                'view_alerts': 'ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™',
                'manage_alerts': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™',
                'respond_incidents': 'ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ŸÑŸÑÿ≠ŸàÿßÿØÿ´',
                'view_reports': 'ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±',
                'generate_reports': 'ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±',
                'export_reports': 'ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±',
                'view_predictions': 'ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÜÿ®ÿ§ÿßÿ™',
                'configure_ai': 'ÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä',
                'manage_users': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ',
                'manage_roles': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿØŸàÿßÿ±',
                'manage_organization': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸÜÿ∏ŸÖÿ©',
                'view_audit_logs': 'ÿπÿ±ÿ∂ ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ™ÿØŸÇŸäŸÇ',
            };

            permissionsGrid.innerHTML = permissions.map(perm => `
                <div class="permission-badge">
                    ${permissionNames[perm] || perm}
                </div>
            `).join('');
        }

        // Perform action (placeholder)
        function performAction(action) {
            alert(`ÿ≥Ÿäÿ™ŸÖ ÿ™ŸÜŸÅŸäÿ∞: ${action}\n\nŸáÿ∞Ÿá ÿßŸÑŸÖŸäÿ≤ÿ© ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä`);
        }

        // Logout function
        async function logout() {
            const token = localStorage.getItem('hazm_token');
            
            if (token) {
                try {
                    await fetch(`${API_BASE}/api/auth/logout`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                } catch (error) {
                    console.error('Logout error:', error);
                }
            }

            localStorage.removeItem('hazm_token');
            localStorage.removeItem('hazm_user');
            window.location.href = '/login.html';
        }
    </script>
</body>
</html>
